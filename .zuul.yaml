# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

- project:
    templates:
      - docs-on-readthedocs
    vars:
      rtd_webhook_id: '47687'
    check:
      jobs:
        - treasuremap-airship-seaworthy-site-lint
        - treasuremap-airskiff-site-lint
        - treasuremap-airsloop-site-lint
        - treasuremap-airskiff-deployment
    gate:
      jobs:
        - treasuremap-airship-seaworthy-site-lint
        - treasuremap-airskiff-site-lint
        - treasuremap-airsloop-site-lint
        - treasuremap-airskiff-deployment

- nodeset:
    name: treasuremap-single-node
    nodes:
      - name: ubuntu-xenial
        label: ubuntu-xenial

- job:
    name: treasuremap-site-lint
    description:
      Lint a site using Pegleg. Default site is airship-seaworthy.
    nodeset: treasuremap-single-node
    timeout: 900
    pre-run:
      - tools/gate/playbooks/install-docker.yaml
      - tools/gate/playbooks/git-config.yaml
    run: tools/gate/playbooks/site-lint.yaml
    required-projects:
      - airship/pegleg
    vars:
      site: airship-seaworthy
    irrelevant-files:
      - ^.*\.rst$
      - ^doc/.*$

- job:
    name: treasuremap-airship-seaworthy-site-lint
    description: |
      Lint the airship-seaworthy site using Pegleg.
    parent: treasuremap-site-lint
    vars:
      site: airship-seaworthy
    irrelevant-files:
      - ^.*\.rst$
      - ^doc/.*$
      - ^site/airskiff/.*$
      - ^site/airsloop/.*$

- job:
    name: treasuremap-airskiff-site-lint
    description: |
      Lint the airskiff site using Pegleg.
    parent: treasuremap-site-lint
    vars:
      site: airskiff
    irrelevant-files:
      - ^.*\.rst$
      - ^doc/.*$
      - ^site/airship-seaworthy/.*$
      - ^site/airsloop/.*$

- job:
    name: treasuremap-airsloop-site-lint
    description: |
      Lint the airsloop site using Pegleg.
    parent: treasuremap-site-lint
    vars:
      site: airsloop
    irrelevant-files:
      - ^.*\.rst$
      - ^doc/.*$
      - ^site/airship-seaworthy/.*$
      - ^site/airskiff/.*$

- job:
    name: treasuremap-airskiff-deployment
    nodeset: treasuremap-single-node
    description: |
      Deploy Memcached using Airskiff and latest Treasuremap changes.
    voting: false
    timeout: 9600
    pre-run:
      - tools/gate/playbooks/git-config.yaml
      - tools/gate/playbooks/airskiff-reduce-site.yaml
    run: tools/gate/playbooks/airskiff-deploy-gate.yaml
    post-run: tools/gate/playbooks/debug-report.yaml
    required-projects:
      - name: airship/armada
      - name: airship/deckhand
      - name: airship/pegleg
      - name: airship/shipyard
      - name: openstack/openstack-helm-infra
    vars:
      OSH_INFRA_PATH: "../../openstack/openstack-helm-infra"
    irrelevant-files:
      - ^.*\.rst$
      - ^doc/.*$
      - ^site/airship-seaworthy/.*$
      - ^site/airsloop/.*$
